## 2024-05-23 - Incomplete Permission Checking in Service Layer
**Vulnerability:** `userRoleService.hasPermission` in `server/src/modules/users/userRole.service.js` only checks role-based permissions (via `role_has_permissions`), completely ignoring direct permissions assigned to the user via `model_has_permissions`.
**Learning:** The application uses two different implementations for checking permissions. The middleware (`permission.middleware.js`) correctly checks both direct and role-based permissions, but the service layer (`userRoleService.js`) does not. This leads to inconsistencies where a user might be allowed access via API (middleware) but denied access in internal logic (service calls like impersonation) if they only rely on direct permissions.
**Prevention:** When checking permissions in business logic, ensure the check includes both direct and role-based sources. Ideally, refactor the codebase to use a single, centralized permission checking function used by both middleware and services to ensure consistency (DRY principle).
